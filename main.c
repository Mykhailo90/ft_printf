/* ************************************************************************** *//*                                                                            *//*                                                        :::      ::::::::   *//*   main.c                                             :+:      :+:    :+:   *//*                                                    +:+ +:+         +:+     *//*   By: msarapii <marvin@42.fr>                    +#+  +:+       +#+        *//*                                                +#+#+#+#+#+   +#+           *//*   Created: 2018/01/30 16:34:49 by msarapii          #+#    #+#             *//*   Updated: 2018/01/30 16:34:51 by msarapii         ###   ########.fr       *//*                                                                            *//* ************************************************************************** */#include "ft_printf.h"int		input_symb(char *str, char ch){	int	i;		i = 0;	while (str[i] != '\0')	{		if (str[i] == ch)			return (1);		i++;	}	return (0);}int					size_wt(wchar_t *tmp){	int				i;	int				n;	i = 0;	n = 0;	while (tmp[i])	{		if (tmp[i] <= 127)			n += 1;		else if (tmp[i] <= 2047)			n += 2;		else if (tmp[i] <= 65535)			n += 3;		else if (tmp[i] <= 1114111)			n += 4;		i++;	}	return (n);}char	*search_sp_D(va_list argptr, t_list *com){	char *res_str;	res_str = NULL;	if (com->size == NULL)		res_str = ft_itoa(va_arg(argptr, long));	else if (input_symb(com->size, 'z'))		res_str = ft_itoa((size_t)va_arg(argptr, size_t));	else if (input_symb(com->size, 't'))		res_str = ft_itoa((ptrdiff_t)va_arg(argptr, ptrdiff_t));	else if (input_symb(com->size, '2'))		res_str = ft_itoa((long long)va_arg(argptr, long long));	else if (input_symb(com->size, 'l'))		res_str = ft_itoa((long)va_arg(argptr, long));	return (prepare_str(com, res_str));}char	*search_sp_U(va_list argptr, t_list *com){	char *res_str;	res_str = NULL;	if (com->size == NULL)		res_str = ft_itoa(va_arg(argptr, unsigned long));	else if (input_symb(com->size, 'z'))		res_str = ft_itoa((size_t)va_arg(argptr, size_t));	else if (input_symb(com->size, 't'))		res_str = ft_itoa(va_arg(argptr, ptrdiff_t));	else if (input_symb(com->size, '2'))		res_str = ft_itoa(va_arg(argptr, unsigned long long));	else if (input_symb(com->size, 'l'))		res_str = ft_itoa(va_arg(argptr, unsigned long));	return (prepare_str(com, res_str));}char	*add_esp_for_c(char *str, t_list *com){	int len_ch;	int width;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen(str);	width = ft_atoi(com->width);	tmp = ft_strnew(width - len_ch);	while (i < (width - len_ch))		tmp[i++] = ' ';	str = (input_symb(com->flags, '-')) ?		ft_strjoin(str, tmp) : ft_strjoin(tmp, str);	free(tmp);	return (str);}unsigned char	*add_esp_for_C(unsigned char *str, t_list *com){	int len_ch;	int width;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen((char *)str);	width = ft_atoi(com->width);	tmp = ft_strnew(width - len_ch);	while (i < (width - len_ch))		tmp[i++] = ' ';	str = (input_symb(com->flags, '-')) ?		ft_strjoin_uv(str, (unsigned char *)tmp) : ft_strjoin_uv((unsigned char *)tmp, str);	free(tmp);	return (str);}unsigned char 	*add_esp_for_C_end(unsigned char *str, t_list *com){		int len_ch;	int width;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen_uv(str);	width = ft_atoi(com->width);	tmp = ft_strnew(width - len_ch);	while (i < (width - len_ch))		tmp[i++] = ' ';	str = ft_strjoin_uv(str, (unsigned char *)tmp);	free(tmp);	return (str);}unsigned char 	*add_null_in_C(unsigned char *str, t_list *com){	int len_ch;	int w;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen_uv(str);	w = ft_atoi(com->width);	tmp = ft_strnew(w - len_ch);	while (i < (w - len_ch))		tmp[i++] = '0';	str = ft_strjoin_uv((unsigned char *)tmp, str);	free(tmp);	return (str);}unsigned char *prepare_str_C(t_list *com, unsigned char *str){	if (com->width && !input_symb(com->flags, '0') &&		(ft_atoi(com->width) > ft_strlen_uv(str)))		str = add_esp_for_C(str, com);	else if (com->width && input_symb(com->flags, '0') &&		!input_symb(com->flags, '-') &&		ft_atoi(com->width) > ft_strlen_uv(str))		str = add_null_in_C(str, com);	else if (com->width && input_symb(com->flags, '0') &&		input_symb(com->flags, '-') &&		(ft_atoi(com->width) > ft_strlen_uv(str)))		str = add_esp_for_C_end(str, com);	return (str);}unsigned char 		*prepare_str_S(t_list *com, unsigned char *res_str){	unsigned char 	*res;	int 			len;	if (com->precision)		len = ft_atoi(com->precision);	res = NULL;	if (com->width && !input_symb(com->flags, '0') &&		(ft_atoi(com->width) > ft_strlen_uv(res_str)))		res_str = add_esp_for_C(res_str, com);	else if (com->width && input_symb(com->flags, '0') &&		!input_symb(com->flags, '-') &&		ft_atoi(com->width) > ft_strlen_uv(res_str))		res_str = add_null_in_C(res_str, com);	else if (com->width && input_symb(com->flags, '0') &&		input_symb(com->flags, '-') &&		(ft_atoi(com->width) > ft_strlen_uv(res_str)))		res_str = add_esp_for_C_end(res_str, com);	return (res_str);}unsigned char  	*search_wt_str(va_list argptr, t_list *com){	wchar_t *tmp;	unsigned char *res_str;	res_str = NULL;	tmp = NULL;	tmp = va_arg(argptr, wchar_t *);	if (com->precision && (ft_atoi(com->precision) < size_wt(tmp)))	{		res_str = convert_in_str1(tmp, ft_atoi(com->precision));	}	else	{		res_str = convert_in_str(tmp);	}	return (res_str);}unsigned char 	*search_sp_s(va_list argptr, t_list *com, char ch){	char *res_str;	unsigned char *res;	res_str = NULL;	res = NULL;	if (com->size == NULL && ch != 'S')		res_str = va_arg(argptr, char *);	else if (ch == 'S' || (com->size && input_symb(com->size, 'l')))	{		res = search_wt_str(argptr, com);		return(prepare_str_S(com, res));	}	return((unsigned char *)prepare_str_s(com, res_str));}char *ft_count_X(unsigned long long num, char *res, char ch){	char *tmp;	tmp = ft_strnew(1);	if (num > 16)		res = ft_count_X(num / 16, res, ch);	if (num % 16 < 10)	{		tmp[0] = (num % 16 + '0');		res = ft_strjoin(res, tmp);	}	else	{		tmp[0] = (ch == 'x') ? (num % 16 - 10 + 'a') : (num % 16 - 10 + 'A');		res = ft_strjoin(res, tmp);	}	free(tmp);	return (res);}char *ft_count_O(unsigned long long num, char *res, char ch){	char *tmp;	tmp = ft_strnew(1);	if (num > 7)		res = ft_count_O(num / 8, res, ch);	tmp[0] = (num % 8 + '0');	res = ft_strjoin(res, tmp);	free(tmp);	return (res);}char *ft_itoa_base(unsigned long long number, char ch){	char *res;	res = ft_strnew(1);	if (ch == 'x' || ch == 'X')		res = ft_count_X(number, res, ch);	else if (ch == 'O' || ch == 'o')		res = ft_count_O(number, res, ch);	return (res);}char *add_hesh(char *res, char ch){	char *for_del;	for_del = res;	char tmp[3];	tmp[0] = '0';	tmp[2] = '\0';	tmp[1] = (ch == 'x') ? 'x' : 'X';	res = ft_strjoin(tmp, res);	free(for_del);	return (res);}char	*add_null_X(t_list *com, char *str){	t_help help;	help.i = ft_strlen(str);	if (input_symb(com->flags, '#'))		help.i = help.i + 2;	if (com->precision)		help.n = ft_atoi(com->precision);	help.tmp = ft_strnew(help.n - help.i);	help.n = help.n - help.i;	help.i = 0;	full_n(help.tmp, help.i, help.n);	str = ft_strjoin(help.tmp, str);	free(help.tmp);	return (str);}char	*add_null_before_X(t_list *com, char *str, char ch){	t_help help;		help.number = ft_atoi(str);	help.i = ft_strlen(str);	if (input_symb(com->flags, '#') && (ch == 'x' || ch == 'X'))		help.i = help.i + 2;	if (input_symb(com->flags, '#') && (ch == 'o' || ch == 'O'))		help.i = help.i + 1;	if (com->width)		help.n = ft_atoi(com->width);	help.tmp = (help.number < 0 || input_symb(com->flags, '+')) ?		ft_strnew(help.n - help.i + 2) : ft_strnew(help.n - help.i);	help.n = help.n - help.i;	help.i = 0;		full_n(help.tmp, help.i, help.n);	str = ft_strjoin(help.tmp, str);	free(help.tmp);	return (str);}char	*prepare_str_x(t_list *com, char *str, char ch){	if (!com->precision &&  com->width && ft_atoi(com->width) > ft_strlen(str) &&		input_symb(com->flags, '0') && !input_symb(com->flags, '-'))		str = add_null_before_X(com, str, ch);	if (input_symb(com->flags, '#') && (ch == 'o' || ch == 'O'))		str = add_hesh_o(str);	if (com->precision && ft_atoi(com->precision) > ft_strlen(str))		str = add_null(com, str);	if (input_symb(com->flags, '#') && (ch == 'x' || ch == 'X'))		str = add_hesh(str, ch);	if (com->precision && com->width && ft_atoi(com->width) > ft_strlen(str) &&		!input_symb(com->flags, '-'))		str = add_esp(str, com);	if (com->width && !input_symb(com->flags, '0') && (ft_atoi(com->width) > ft_strlen(str)))		str = add_esp(str, com);	if (com->width && input_symb(com->flags, '-') && (ft_atoi(com->width) > ft_strlen(str)))		str = add_esp(str, com);	return (str);}unsigned char 	*search_sp_x(va_list argptr, t_list *com, char ch){	char *res_str;	res_str = NULL;	if (com->size == NULL)		res_str = ft_itoa_base(va_arg(argptr, unsigned int), ch);	else if (input_symb(com->size, 'z'))		res_str = ft_itoa_base((size_t)va_arg(argptr, size_t), ch);	else if (input_symb(com->size, 't'))		res_str = ft_itoa_base(va_arg(argptr, ptrdiff_t), ch);	else if (input_symb(com->size, 'j'))		res_str = ft_itoa_base((intmax_t)va_arg(argptr, uintmax_t), ch);	else if (input_symb(com->size, '2'))		res_str = ft_itoa_base((long long)va_arg(argptr, unsigned long long), ch);	else if (input_symb(com->size, 'l'))		res_str = ft_itoa_base((long)va_arg(argptr, unsigned long), ch);	else if (input_symb(com->size, 'h'))		res_str = ft_itoa_base((unsigned short)va_arg(argptr, int), ch);	else if (input_symb(com->size, '1'))		res_str = ft_itoa_base((unsigned char)va_arg(argptr, int), ch);	return ((unsigned char *)prepare_str_x(com, res_str, ch));}char	*search_sp_u(va_list argptr, t_list *com, char ch){	char *res_str;	res_str = NULL;	if (com->size == NULL)		res_str = ft_itoa(va_arg(argptr, unsigned int));	else if (input_symb(com->size, 'z'))		res_str = ft_itoa((size_t)va_arg(argptr, size_t));	else if (input_symb(com->size, 't'))		res_str = ft_itoa((unsigned long long)va_arg(argptr, ptrdiff_t));	else if (input_symb(com->size, 'j'))		res_str = ft_itoa((intmax_t)va_arg(argptr, uintmax_t));	else if (input_symb(com->size, '2'))		res_str = ft_itoa(va_arg(argptr, unsigned long long));	else if (input_symb(com->size, 'l'))		res_str = ft_itoa(va_arg(argptr, unsigned long));	else if (input_symb(com->size, 'h'))		res_str = ft_itoa((unsigned short)va_arg(argptr, int));	else if (input_symb(com->size, '1'))		res_str = ft_itoa((unsigned char)va_arg(argptr, int));	return (prepare_str(com, res_str));}int	form_string(va_list argptr, char *str, t_list *com){		char ch;	unsigned char *res;	int len;	ch = com->specificator;	if (ch == 'd' || ch == 'i')		res = (unsigned char *)search_sp_d(argptr, com);	else if (ch == 'D' || ch == 'U')		res = (unsigned char *)search_sp_D(argptr, com);	else if (ch == 'c' || ch == 'C')	 	res = (unsigned char *)search_sp_c(argptr, com, ch);	 else if (ch == '%')	 	res = (unsigned char *)prepare_str_ex(com);	 else if (ch == 's' || ch == 'S')	 	res = (unsigned char *)search_sp_s(argptr, com, ch);	 else if (ch == 'x' || ch == 'X' || ch == 'O' || ch == 'o')	 	res = (unsigned char *)search_sp_x(argptr, com, ch);	 else if (ch == 'u')	 	res = (unsigned char *)search_sp_u(argptr, com, ch);	len = (int)ft_strlen_uv(res);	ft_putstr(res);	return (len);}void read_com_str(t_list *com, char *str){	set_list_null(com);	search_specificator(com, str);	search_flags(com, str);	search_width(com, str);	search_precision(com, str);	search_size(com, str);}int	ft_printf(char *str, ...){	va_list argptr;	t_list com;	int i;	char *head;	int res;	i = 0;	res = 0;	head = str;	va_start(argptr, str);	while (str[i] != '\0')	{		if (str[i] == '%')		{			read_com_str(&com, &str[++i]);			res += form_string(argptr, head, &com);			set_list_null(&com);			while (is_input_spec(str[++i - 1]) == -1)				;		}		ft_putchar(str[i]);		i++;		res++;	}	va_end(argptr);	return (res);}int		main(void){	 setlocale(LC_ALL, "");//	t_list test;//	read_com_str(&test, "0.1+hhh-#.ll6l0 0hd");	//	printf("prec=%s\n", test.size);	wint_t i;	int n;	int x;	char ch = 'F';	char str[] = "TEST 012345 TEST";	i = 80;	n = -71;	wchar_t *wide = L"ПРОБУЕМ РУССКИЙ ЯЗЫК ();.,:";	wchar_t t = 945;		//    printf("Eto idend D = %010d is N\n", i);	// ft_printf("Eto idend D = %010d is N\n", i);	//    printf("Eto idend D = %010d is N\n", n);	// ft_printf("Eto idend D = %010d is N\n", n);		ft_printf("X= %u\n", 942);	   printf("X= %u\n", 942);	// printf("Ret=%d\n", n);	// x = ft_printf("!!!%d\n", i);	 //  printf("X=%o\n", 3256);	//    printf("Eto idend ch = %-010%c is N\n", ch);	// ft_printf("Eto idend ch = %-010%c is N\n", ch);	return 0; }