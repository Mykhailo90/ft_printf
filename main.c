/* ************************************************************************** *//*                                                                            *//*                                                        :::      ::::::::   *//*   main.c                                             :+:      :+:    :+:   *//*                                                    +:+ +:+         +:+     *//*   By: msarapii <marvin@42.fr>                    +#+  +:+       +#+        *//*                                                +#+#+#+#+#+   +#+           *//*   Created: 2018/01/30 16:34:49 by msarapii          #+#    #+#             *//*   Updated: 2018/01/30 16:34:51 by msarapii         ###   ########.fr       *//*                                                                            *//* ************************************************************************** */ #include "ft_printf.h"int		is_input_spec(char ch){	if (ch == 'c' || ch == 's' || ch == 'd' || ch == 'i' || ch == '%' ||		ch == 'x' || ch == 'X' || ch == 'u' || ch == 'f' || ch == 'F' ||		ch == 'e' || ch == 'E' || ch == 'a' || ch == 'A' || ch == 'g' ||		ch == 'G' || ch == 'n' || ch == 'p')		return ((int)(ch - '0'));	return (-1);}int 	is_it_flags(char ch){	if (ch == ' ' || ch == '-' || ch == '+' || ch == '#' || ch == '0')		return (1);	return (0);}int 	is_it_size(char ch){	if (ch == 'j' || ch == 'L' || ch == 'z' || ch == 't' || ch == 'h' ||		ch == 'l')		return (1);	else		return (0);}void	search_specificator(t_list *commands, char *str){	int i;	i = 0;	while (str[i] != '\0' && is_input_spec(str[i]) == -1)	{		i++;	}	commands->specificator = str[i];}size_t 	len_fl(char *str){	size_t i;	i = 0;	while (is_it_flags(str[i]))		i++;	return (i);}size_t 	len_w(char *str){	size_t i;	i = 0;	while (ft_isdigit(str[i]))		i++;	return (i);}size_t 	len_s(char *str){	size_t i;	i = 0;	while (is_it_size(str[i]))		i++;	return (i);}void 	search_flags(t_list *commands, char *str){	int i;	i = 0;	while (str[i] != '\0' && is_input_spec(str[i]) == -1)	{		if (is_it_flags(str[i]) && (str[i - 1] == '%' ||			is_it_flags(str[i - 1])))		{			commands->flags = ft_memalloc(sizeof(char) * len_fl(&str[i]));			commands->flags = ft_strncpy(commands->flags, &str[i], len_fl(&str[i]));			break;		}		i++;	}}void search_width(t_list *commands, char *str){	int i;	i = 0;	while (str[i] != '\0' && is_input_spec(str[i]) == -1)	{		if (ft_isdigit(str[i]) &&			(str[i - 1] == '%' || is_it_flags(str[i - 1])))		{			commands->width = ft_memalloc(sizeof(char) * len_w(&str[i]));			commands->width = ft_strncpy(commands->width, &str[i], len_w(&str[i]));			break;		}		i++;	}}void search_precision(t_list *commands, char *str){	int i;	i = 0;	while (str[i] != '\0' && is_input_spec(str[i]) == -1)	{		if (str[i] == '.' && ft_isdigit(str[i + 1]) == 1 && (str[i - 1] == '%' ||			is_it_flags(str[i - 1]) ||			ft_isdigit(str[i - 1] == 1)))		{			commands->precision = ft_memalloc(sizeof(char) * len_w(&str[i + 1]));			commands->precision = ft_strncpy(commands->precision, &str[i + 1], len_w(&str[i + 1]));			break;		}		i++;	}}void search_size(t_list *commands, char *str){	int i;	i = 0;	while (str[i] != '\0' && is_input_spec(str[i]) == -1)	{		if (is_it_size(str[i]))		{			if (str[i + 1] == 'h' || str[i + 1] == 'l' || is_input_spec(str[i + 1]) > -1)			{				commands->size = ft_memalloc(sizeof(char) * len_s(&str[i]));				commands->size = ft_strncpy(commands->size, &str[i], len_s(&str[i]));				break;			}								break;				}		i++;	}}int search_com_size(char *str){	int i;	i = 0;	while (str[i] != '\0' && is_input_spec(str[i]) == -1)		i++;	return (i);}int search_error(t_list *commands, char *str){	int size_com;	int size_in_list;	size_in_list = 0;	size_com = search_com_size(str);	if (commands->flags)		size_in_list += (int)ft_strlen(commands->flags);	if (commands->width)		size_in_list += (int)ft_strlen(commands->width);	if (commands->precision)		size_in_list += (int)ft_strlen(commands->precision) + 1;	if (commands->size)		size_in_list += (int)ft_strlen(commands->size);	if (size_in_list == size_com)		return (0);	return (1);}//Выносим символ проценты в спецификаторы и обрабатываем сначала наличие ошибок...// int search_exeptions(char *str)// {// 	char *str_base;// 	int i;// 	int flag;// 	i = 0;// 	flag = 0;// 	str_base = str;// 	while (is_input_spec(str[i]) == -1)// 	{// 		if (str[i] == '%')// 		{// 			flag = 1;// 			ft_putchar(str[i++]);// 			while (str[i] != '\0' && str[i] != '%' && is_input_spec(str[i -1]) == -1)// 				ft_putchar(str[i++]);// 			break;// 		}// 		i++;// 	}// 	return (flag);// }void print_er(char *str){	int i;	int flag;	i = 0;	flag = 0;	write(1, "%", 1);	while (str[i] != '\0' && str[i] != '%')	{		if (str[i] == '.' && str[i + 1] == '.' && flag == 0)		{			write(1, ".0", 2);			i++;			flag++;		}		ft_putchar(str[i++]);	}}void set_list_null(t_list *com){	com->size = NULL;	com->precision = NULL;	com->width = NULL;	com->flags = NULL;}int analiz_str(char *str, t_list *com){	int flag;	flag = 0;	set_list_null(com);	search_flags(com, str);	search_width(com, str);	search_precision(com, str);	search_size(com, str);	search_specificator(com, str);	if (search_error(com, str))	{		flag = 1;		print_er(str);	}	return (flag);}void	form_string(va_list argptr, char *str, t_list *com){	char ch;	char *res_str;	ch = com->specificator;	if ((ch == 'd' || ch == 'i') && com->size == NULL)		res_str = ft_itoa(va_arg(argptr, int));	else if ((ch == 'd' || ch == 'i') && (!ft_strcmp(com->size, "hh")))		res_str = ft_itoa((signed char)va_arg(argptr, size_t));	else if ((ch == 'd' || ch == 'i') && (!ft_strcmp(com->size, "h")))		res_str = ft_itoa((short)va_arg(argptr, size_t));	else if ((ch == 'd' || ch == 'i') && (!ft_strcmp(com->size, "ll")))		res_str = ft_itoa((long long)va_arg(argptr, size_t));	else if ((ch == 'd' || ch == 'i') && (!ft_strcmp(com->size, "l")))		res_str = ft_itoa((long)va_arg(argptr, size_t));	else if ((ch == 'd' || ch == 'i') && (!ft_strcmp(com->size, "j")))		res_str = ft_itoa((intmax_t)va_arg(argptr, intmax_t));	else if ((ch == 'd' || ch == 'i') && (!ft_strcmp(com->size, "z")))		res_str = ft_itoa((size_t)va_arg(argptr, size_t));	else if ((ch == 'd' || ch == 'i') && (!ft_strcmp(com->size, "t")))		res_str = ft_itoa((ptrdiff_t)va_arg(argptr, ptrdiff_t));	ft_putstr(res_str);}void struct_str(char *str, int i){	char *str_f;	int i;	i = 0;	while (str[i] != '%' && str[i] != '\0')		i++;	str_f = ft_strnew(i);	str_f = ft_strncpy(str_f, str, i);	}void	ft_printf(char *str, ...){	va_list argptr;	t_list com;	int i;	char *head;	i = 0;	head = str;	va_start(argptr, str);	struct_str(str);	while (str[i] != '\0')	{		if (str[i] == '%')		{			if(!analiz_str(&str[++i], &com))				form_string(argptr, head, &com);			else			{				while (str[i] != '%' && str[i] != '\0')				i++;			}					}		else		ft_putchar(str[i]);		i++;	}	va_end(argptr);}// Разобраться со значениями в циклах!!!int		main(void){	int i;	int n;	i = 777;	n = 777;	ft_printf("Eto idend D = %10..d is N = %d is%dabc\n", i, n);	printf("Eto idend D = %10..d is N = %d is%dabc\n", i, n);	return 0; }