/* ************************************************************************** *//*                                                                            *//*                                                        :::      ::::::::   *//*   main.c                                             :+:      :+:    :+:   *//*                                                    +:+ +:+         +:+     *//*   By: msarapii <marvin@42.fr>                    +#+  +:+       +#+        *//*                                                +#+#+#+#+#+   +#+           *//*   Created: 2018/01/30 16:34:49 by msarapii          #+#    #+#             *//*   Updated: 2018/01/30 16:34:51 by msarapii         ###   ########.fr       *//*                                                                            *//* ************************************************************************** */ #include "ft_printf.h"void set_list_null(t_list *com){	com->size = NULL;	com->precision = NULL;	com->width = NULL;	com->flags = NULL;}int		input_symb(char *str, char ch){	int	i;		i = 0;	while (str[i] != '\0')	{		if (str[i] == ch)			return (1);		i++;	}	return (0);}char	*search_sp_d(va_list argptr, t_list *com){	char *res_str;	res_str = NULL;	if (com->size == NULL)		res_str = ft_itoa(va_arg(argptr, int));	else if (input_symb(com->size, 'z'))		res_str = ft_itoa((size_t)va_arg(argptr, size_t));	else if (input_symb(com->size, 't'))		res_str = ft_itoa((ptrdiff_t)va_arg(argptr, ptrdiff_t));	else if (input_symb(com->size, 'j'))		res_str = ft_itoa((intmax_t)va_arg(argptr, intmax_t));	else if (input_symb(com->size, '2'))		res_str = ft_itoa((long long)va_arg(argptr, long long));	else if (input_symb(com->size, 'l'))		res_str = ft_itoa((long)va_arg(argptr, long));	else if (input_symb(com->size, 'h'))		res_str = ft_itoa((short)va_arg(argptr, int));	else if (input_symb(com->size, '1'))		res_str = ft_itoa((signed char)va_arg(argptr, int));	return (prepare_str(com, res_str));}char	*add_esp_for_c(char *str, t_list *com){	int len_ch;	int width;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen(str);	width = ft_atoi(com->width);	tmp = ft_strnew(width - len_ch);	while (i < (width - len_ch))		tmp[i++] = ' ';	//if (!input_symb(com->flags, '0'))		str = (input_symb(com->flags, '-')) ?			ft_strjoin(str, tmp) : ft_strjoin(tmp, str);	free(tmp);	return (str);}unsigned char	*add_esp_for_C(unsigned char *str, t_list *com){	int len_ch;	int width;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen((char *)str);	width = ft_atoi(com->width);	tmp = ft_strnew(width - len_ch);	while (i < (width - len_ch))		tmp[i++] = ' ';	str = (input_symb(com->flags, '-')) ?		ft_strjoin_U(str, (unsigned char *)tmp) : ft_strjoin_U((unsigned char *)tmp, str);	free(tmp);	return (str);}char 	*add_esp_for_c_end(char *str, t_list *com){		int len_ch;	int width;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen(str);	width = ft_atoi(com->width);	tmp = ft_strnew(width - len_ch);	while (i < (width - len_ch))		tmp[i++] = ' ';	str = ft_strjoin(str, tmp);	free(tmp);	return (str);}unsigned char 	*add_esp_for_C_end(unsigned char *str, t_list *com){		int len_ch;	int width;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen_U(str);	width = ft_atoi(com->width);	tmp = ft_strnew(width - len_ch);	while (i < (width - len_ch))		tmp[i++] = ' ';	str = ft_strjoin_U(str, (unsigned char *)tmp);	free(tmp);	return (str);}char 	*add_null_in_c(char *str, t_list *com){	int len_ch;	int w;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen(str);	w = ft_atoi(com->width);	tmp = ft_strnew(w - len_ch);	while (i < (w - len_ch))		tmp[i++] = '0';	str = ft_strjoin(tmp, str);	free(tmp);	return (str);}unsigned char 	*add_null_in_C(unsigned char *str, t_list *com){	int len_ch;	int w;	char *tmp;	int i;	i = 0;	len_ch = ft_strlen_U(str);	w = ft_atoi(com->width);	tmp = ft_strnew(w - len_ch);	while (i < (w - len_ch))		tmp[i++] = '0';	str = ft_strjoin_U((unsigned char *)tmp, str);	free(tmp);	return (str);}int size_wt(wchar_t *tmp){	int i;	int n;	i = 0;	n = 0;	while (tmp[i])	{		if (tmp[i] <= 127)			n += 1;		else if (tmp[i] <= 2047)			n += 2;		else if (tmp[i] <= 65535)			n += 3;		else if (tmp[i] <= 1114111)			n += 4;		i++; 	}	return (n);}size_t count_res2(wchar_t *tmp, unsigned char *res, int *i, int *n){	if (tmp[*i] <= 65535)	{		res[*(n++)] = ((tmp[*i] >> 12) + 0b11100000);		res[*(n++)] = (((tmp[*i] >> 6) & 0b111111) + 0b10000000);		res[*(n++)] = ((tmp[*i] & 0b111111) + 0b10000000);		return (3);	}	else if (tmp[*i] <= 1114111)	{		res[*(n++)] = ((tmp[*i] >> 18) + 0b11110000);		res[*(n++)] = (((tmp[*i] >> 12) & 0b111111) + 0b10000000);		res[*(n++)] = (((tmp[*i] >> 6) & 0b111111) + 0b10000000);		res[*(n++)] = ((tmp[*i] & 0b111111) + 0b10000000);		return (4);	}	return (0);}// size_t func_help(wchar_t *tmp, unsigned char *res)// {// 	int i;// 	int n;// 	size_t l;// 	i = -1;// 	n = 0;// 	l = 0;// 	while (tmp[++i] != '\0')// 		{// 			if (tmp[i] <= 127)// 			{// 				res[n++] = (unsigned char)tmp[i];// 				l += 1;// 			}// 			else if (tmp[i] <= 2047)// 			{// 				res[n++] = ((tmp[i] >> 6) + 0b11000000);// 				res[n++] = ((tmp[i] & 0b111111) + 0b10000000);// 				l += 2;// 			}// 			else // 				l += count_res2(tmp, res, &i, &n);// 		}// 		return (l);// }size_t func_help1(wchar_t *tmp, unsigned char *res, size_t len){	int i;	int n;	size_t l;	i = -1;	n = 0;	l = 0;	while (((size_t)++i) < len)		{			if (tmp[i] <= 127)			{				res[n++] = (unsigned char)tmp[i];				l += 1;			}			else if (tmp[i] <= 2047)			{				res[n++] = ((tmp[i] >> 6) + 0b11000000);				res[n++] = ((tmp[i] & 0b111111) + 0b10000000);				l += 2;			}			else 				l += count_res2(tmp, res, &i, &n);		}		return (l);}size_t count_res1(wchar_t *tmp, unsigned char *res, size_t len){	size_t l;	l = 0;	l = func_help1(tmp, res, len);	return (l);}unsigned char  	*convert_in_str(wchar_t *tmp){	int len;	unsigned char *res;	len = size_wt(tmp);	res = (unsigned char *)ft_strnew(len);	count_res1(tmp, res, len);	return (res);}unsigned char  	*convert_in_str1(wchar_t *tmp, size_t l){	int len;	unsigned char *res;	len = size_wt(tmp);	res = (unsigned char *)ft_strnew(l);	count_res1(tmp, res, l);	return (res);}char	*prepare_str_c(t_list *com, char *str){	if (com->width && !input_symb(com->flags, '0') &&		(ft_atoi(com->width) > ft_strlen(str)))		str = add_esp_for_c(str, com);	else if (com->width && input_symb(com->flags, '0') &&		!input_symb(com->flags, '-') &&		ft_atoi(com->width) > ft_strlen(str))		str = add_null_in_c(str, com);	else if (com->width && input_symb(com->flags, '0') &&		input_symb(com->flags, '-') &&		(ft_atoi(com->width) > ft_strlen(str)))		str = add_esp_for_c_end(str, com);	return (str);}unsigned char *prepare_str_C(t_list *com, unsigned char *str){	if (com->width && !input_symb(com->flags, '0') &&		(ft_atoi(com->width) > ft_strlen_U(str)))		str = add_esp_for_C(str, com);	else if (com->width && input_symb(com->flags, '0') &&		!input_symb(com->flags, '-') &&		ft_atoi(com->width) > ft_strlen_U(str))		str = add_null_in_C(str, com);	else if (com->width && input_symb(com->flags, '0') &&		input_symb(com->flags, '-') &&		(ft_atoi(com->width) > ft_strlen_U(str)))		str = add_esp_for_C_end(str, com);	return (str);}//!!!!!!!!!!!!!!!!!!!! Дописать вывод символа через функции строк!unsigned char		*search_sp_c(va_list argptr, t_list *com, char s){	char 			*res_str;	unsigned char 	*str;		str = NULL;	res_str = NULL;	wchar_t	ch [2];		if (com->size == NULL && s != 'C')	{		res_str = ft_strnew(1);		res_str[0] = va_arg(argptr, int);	}	else if (s == 'C' || input_symb(com->size, 'l'))	{		ch[0] = va_arg(argptr, wint_t);		ch[1] = '\0';		str = convert_in_str(ch);		return (prepare_str_C(com, str));	}	return ((unsigned char *)prepare_str_c(com, res_str));}char 	*prepare_str_ex(t_list *com){	char *res_str;		res_str = ft_strnew(1);	res_str[0] = '%';	if (com->width && ft_atoi(com->width) > 1)		res_str = add_esp(res_str, com);	return (res_str);}char 	*prepare_str_s(t_list *com, char *res_str){	char 	*res;	int 	len;	if (com->precision)		len = ft_atoi(com->precision);	res = NULL;	if (com->precision && len < ft_strlen(res_str))	{		res = ft_strnew(len);		ft_strncpy(res, res_str, len);		res_str = res;	}	if (com->width && !input_symb(com->flags, '0') &&		(ft_atoi(com->width) > ft_strlen(res_str)))		res_str = add_esp_for_c(res_str, com);	else if (com->width && input_symb(com->flags, '0') &&		!input_symb(com->flags, '-') &&		ft_atoi(com->width) > ft_strlen(res_str))		res_str = add_null_in_c(res_str, com);	else if (com->width && input_symb(com->flags, '0') &&		input_symb(com->flags, '-') &&		(ft_atoi(com->width) > ft_strlen(res_str)))		res_str = add_esp_for_c_end(res_str, com);	// if (com->width && ft_atoi(com->width) > ft_strlen(res_str))	// 	res_str = add_esp_for_c(res_str, com);	// if (input_symb(com->flags, '0') && !input_symb(com->flags, '-'))	// 	res_str = add_null_in_c(res_str, com);	return (res_str);}unsigned char 		*prepare_str_S(t_list *com, unsigned char *res_str){	unsigned char 	*res;	int 			len;	if (com->precision)		len = ft_atoi(com->precision);	res = NULL;	if (com->precision && len < ft_strlen_U(res_str))	{		res = (unsigned char *)ft_strnew(len);		ft_strncpy_U(res, res_str, len);		res_str = res;	}	if (com->width && !input_symb(com->flags, '0') &&		(ft_atoi(com->width) > ft_strlen_U(res_str)))		res_str = add_esp_for_C(res_str, com);	else if (com->width && input_symb(com->flags, '0') &&		!input_symb(com->flags, '-') &&		ft_atoi(com->width) > ft_strlen_U(res_str))		res_str = add_null_in_C(res_str, com);	else if (com->width && input_symb(com->flags, '0') &&		input_symb(com->flags, '-') &&		(ft_atoi(com->width) > ft_strlen_U(res_str)))		res_str = add_esp_for_C_end(res_str, com);	// if (com->width && ft_atoi(com->width) > ft_strlen(res_str))	// 	res_str = add_esp_for_c(res_str, com);	// if (input_symb(com->flags, '0') && !input_symb(com->flags, '-'))	// 	res_str = add_null_in_c(res_str, com);	return (res_str);}unsigned char  	*search_wt_str(va_list argptr, t_list *com){	wchar_t *tmp;	unsigned char *res_str;	res_str = NULL;	tmp = NULL;	tmp = va_arg(argptr, wchar_t *);	if (com->precision && (ft_atoi(com->precision) < size_wt(tmp)))		res_str = convert_in_str1(tmp, size_wt(tmp));	else		res_str = convert_in_str(tmp);	return (res_str);}unsigned char 	*search_sp_s(va_list argptr, t_list *com, char ch){	char *res_str;	unsigned char *res;	res_str = NULL;	res = NULL;	if (com->size == NULL && ch != 'S')		res_str = va_arg(argptr, char *);	else if (ch == 'S' || (com->size && input_symb(com->size, 'l')))	{		res = search_wt_str(argptr, com);		return(prepare_str_S(com, res));	}	return((unsigned char *)prepare_str_s(com, res_str));}void	form_string(va_list argptr, char *str, t_list *com){		char ch;	unsigned char *res;	ch = com->specificator;	if (ch == 'd' || ch == 'i')		res = (unsigned char *)search_sp_d(argptr, com);	else if (ch == 'c' || ch == 'C')	 	res = (unsigned char *)search_sp_c(argptr, com, ch);	 else if (ch == '%')	 	res = (unsigned char *)prepare_str_ex(com);	 else if (ch == 's' || ch == 'S')	 	res = (unsigned char *)search_sp_s(argptr, com, ch);	ft_putstr(res);}void read_com_str(t_list *com, char *str){	set_list_null(com);	search_specificator(com, str);	search_flags(com, str);	search_width(com, str);	search_precision(com, str);	search_size(com, str);}void	ft_printf(char *str, ...){	va_list argptr;	t_list com;	int i;	char *head;	i = 0;	head = str;	va_start(argptr, str);	while (str[i] != '\0')	{		if (str[i] == '%')		{			read_com_str(&com, &str[++i]);			form_string(argptr, head, &com);			set_list_null(&com);			while (is_input_spec(str[++i - 1]) == -1)				;		}		ft_putchar(str[i]);		i++;	}	va_end(argptr);}int		main(void){	 setlocale(LC_ALL, "");//	t_list test;//	read_com_str(&test, "0.1+hhh-#.ll6l0 0hd");	//	printf("prec=%s\n", test.size);	wint_t i;	int n;	char ch = 'F';	char str[] = "TEST 012345 TEST";	i = 80;	n = -71;	wchar_t *wide = L"ПРОБУЕМ РУССКИЙ ЯЗЫК ();.,:%";		//    printf("Eto idend D = %010d is N\n", i);	// ft_printf("Eto idend D = %010d is N\n", i);	//    printf("Eto idend D = %010d is N\n", n);	// ft_printf("Eto idend D = %010d is N\n", n);		   printf("!!!%.1S\n", wide);	ft_printf("!!!%.1S\n", wide);	//    printf("Eto idend ch = %-010%c is N\n", ch);	// ft_printf("Eto idend ch = %-010%c is N\n", ch);	return 0; }